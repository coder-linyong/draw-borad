(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"22dd":function(t,e,n){t.exports={brushContainer:"brush_brushContainer_2l19Z"}},"2e08":function(t,e,n){t.exports={imgContainer:"img_imgContainer_2wzf3",img:"img_img_2uMoM",drop:"img_drop_2zKPv",lt:"img_lt_23jTi",rt:"img_rt_2-SVI",rb:"img_rb_3HZgr",lb:"img_lb_3V_H0",rotate:"img_rotate_1OMjw"}},"4aa7":function(t,e,n){t.exports={content:"Index_content_1FGv_",dropImg:"Index_dropImg_2-hK7"}},"5b88":function(t,e,n){"use strict";var o=n("4aa7"),r=n.n(o);n.d(e,"default",(function(){return r.a}))},"8b24":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"items-center justify-evenly column overflow-hidden"},[n("div",{staticClass:"row full-width bg-primary text-white q-pa-xs justify-center q-gutter-md"},[n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"brush"},on:{click:function(e){t.drawStatus="brush"}}},[n("q-menu",{attrs:{anchor:"bottom middle",self:"top middle","transition-show":"scale","transition-hide":"scale"}},[n("BrushComponent",{attrs:{brushSync:t.brush},on:{"update:brushSync":function(e){t.brush=e},"update:brush-sync":function(e){t.brush=e}}})],1)],1),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"iconfont dbxingzhuang"}}),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"image"},on:{click:t.chooseFile}},[n("q-tooltip",[t._v("添加图片")])],1),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"title"}},[n("q-tooltip",[t._v("添加文本")])],1),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"iconfont dbxiangpicha"},on:{click:function(e){t.drawStatus="eraser"}}},[n("q-menu",{attrs:{anchor:"bottom middle",self:"top middle","transition-show":"scale","transition-hide":"scale"}},[n("EraserComponent",{attrs:{eraserSync:t.eraser},on:{"update:eraserSync":function(e){t.eraser=e},"update:eraser-sync":function(e){t.eraser=e}}})],1)],1),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"refresh"},on:{click:t.reset}},[n("q-tooltip",[t._v("重置画板")])],1),n("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"download"},on:{click:t.download}},[n("q-tooltip",[t._v("保存为图片")])],1)],1),n("q-drawer",{attrs:{side:"right",overlay:"",behavior:"desktop",bordered:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}}),n("div",{ref:"content",staticClass:"col full-width",class:t.$style.content,on:{mousedown:t.contentMouseDown,wheel:t.contentWheel,mouseup:t.contentMouseUp}},[n("canvas",{ref:"board",style:{transform:"translate3d("+t.translatePos.x+"px,"+t.translatePos.y+"px,"+t.translatePos.z+"px)",cursor:t.cursor},attrs:{id:"board"},on:{mousemove:t.boardMouseMove,mouseup:t.boardMouseUp,dragenter:function(e){return e.preventDefault(),t.dropHandler(e)},dragleave:function(e){return e.preventDefault(),t.dropHandler(e)},dragover:function(e){return e.preventDefault(),t.dropHandler(e)},drop:function(e){return e.preventDefault(),t.dropHandler(e)},contextmenu:function(t){t.preventDefault()},mousedown:t.boardMouseDown}})])],1)},r=[],s=n("60a3"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-card",{staticClass:"q-pa-md",class:t.$style.brushContainer},[n("q-card-section",[n("div",{staticClass:"row"},[n("div",[t._v("粗细")]),n("q-space"),n("div",[t._v(t._s(t.brush.size)+"px")])],1),n("q-slider",{attrs:{min:t.minSize,max:t.maxSize,step:1},model:{value:t.brush.size,callback:function(e){t.$set(t.brush,"size",e)},expression:"brush.size"}}),n("div",{staticClass:"row"},[n("div",[t._v("不透明度")]),n("q-space"),n("div",[t._v(t._s((100*t.brush.transparency/255).toFixed(2))+"%")])],1),n("q-slider",{attrs:{min:t.minTransparency,max:t.maxTransparency,step:1},model:{value:t.brush.transparency,callback:function(e){t.$set(t.brush,"transparency",e)},expression:"brush.transparency"}}),n("div",{staticClass:"row items-center"},[n("div",[t._v("颜色")]),n("q-space"),n("q-btn",{style:{background:t.brush.color},attrs:{round:"",dense:""}},[n("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[n("q-color",{model:{value:t.brush.color,callback:function(e){t.$set(t.brush,"color",e)},expression:"brush.color"}})],1)],1)],1)],1)],1)},a=[];class c{constructor({size:t=1,transparency:e=255,color:n="#000"}={}){const{maxSize:o,minSize:r,maxTransparency:s,minTransparency:i}=c;this.size=t<r?r:Math.min(o,t),this.transparency=e<i?i:Math.min(s,e),this.color=n}}c.maxSize=100,c.minSize=1,c.maxTransparency=255,c.minTransparency=1;var l=function(t,e,n,o){var r,s=arguments.length,i=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i};let u=class extends s["f"]{constructor(){super(...arguments),this.minSize=c.minSize,this.maxSize=c.maxSize,this.minTransparency=c.minTransparency,this.maxTransparency=c.maxTransparency}};l([Object(s["d"])("brushSync")],u.prototype,"brush",void 0),u=l([s["a"]],u);var d=u,h=d,p=n("f403"),m=n("2877"),f=n("f09f"),v=n("a370"),b=n("2c91"),y=n("c1d0"),g=n("9c40"),w=n("7cbe"),x=n("b498"),_=n("eebe"),S=n.n(_);function z(t){this["$style"]=p["default"].locals||p["default"]}var C=Object(m["a"])(h,i,a,!1,z,null,null),M=C.exports;S()(C,"components",{QCard:f["a"],QCardSection:v["a"],QSpace:b["a"],QSlider:y["a"],QBtn:g["a"],QPopupProxy:w["a"],QColor:x["a"]});var q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-card",{staticClass:"q-pa-md",class:t.$style.eraserContainer},[n("q-card-section",[n("div",{staticClass:"row"},[n("div",[t._v("大小")]),n("q-space"),n("div",[t._v(t._s(t.eraser.size)+"px")])],1),n("q-slider",{attrs:{min:t.minSize,max:t.maxSize,step:1},model:{value:t.eraser.size,callback:function(e){t.$set(t.eraser,"size",e)},expression:"eraser.size"}})],1)],1)},D=[];class k{constructor({size:t=1}={}){const{maxSize:e,minSize:n}=k;this.size=t<n?n:Math.min(e,t)}}k.maxSize=100,k.minSize=1;var j=function(t,e,n,o){var r,s=arguments.length,i=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i};let O=class extends s["f"]{constructor(){super(...arguments),this.minSize=k.minSize,this.maxSize=k.maxSize}};j([Object(s["d"])("eraserSync")],O.prototype,"eraser",void 0),O=j([s["a"]],O);var $=O,P=$,T=n("a71d");function R(t){this["$style"]=T["default"].locals||T["default"]}var Q=Object(m["a"])(P,q,D,!1,R,null,null),E=Q.exports;S()(Q,"components",{QCard:f["a"],QCardSection:v["a"],QSpace:b["a"],QSlider:y["a"]});var I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",class:t.$style.imgContainer,on:{wheel:function(t){t.stopPropagation()},mousemove:t.mouseMove,mouseup:t.mouseup,mousedown:function(e){return e.preventDefault(),t.mouseDown(e)}}},[n("div",{ref:"box",class:t.$style.img,style:t.imgStyle,on:{mousedown:function(t){t.preventDefault()}}},[n("img",{ref:"img",attrs:{src:t.url},on:{mousedown:function(t){t.preventDefault()}}}),t._l(t.dropBlock,(function(e){return n("div",{class:[t.$style.drop,t.$style[e]],attrs:{"data-pos":e},on:{mousedown:function(t){t.preventDefault()}}})})),n("q-btn",{staticClass:"absolute-center bg-white",style:{transform:"translate(-50%,-50%) rotate("+-t.rotate+"deg)"},attrs:{flat:"",dense:"",icon:"done",round:""},on:{click:t.complete}})],2),n("q-slider",{staticClass:"absolute-bottom",class:t.$style.rotate,staticStyle:{width:"300px"},attrs:{max:360,min:0,label:"","label-value":t.rotate+"°"},model:{value:t.rotate,callback:function(e){t.rotate=e},expression:"rotate"}})],1)},L=[],U=function(t,e,n,o){var r,s=arguments.length,i=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i},H=function(t,e,n,o){function r(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function i(t){try{c(o.next(t))}catch(e){s(e)}}function a(t){try{c(o["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):r(t.value).then(i,a)}c((o=o.apply(t,e||[])).next())}))};let W=class extends s["f"]{constructor(){super(...arguments),this.width=0,this.height=0,this.drop=!1,this.dropDirection="rb",this.rotate=0,this.move=!1,this.pos={x:0,y:0},this.dropBlock=["lt","rt","rb","lb"]}get imgStyle(){const{pos:t,width:e,height:n,rotate:o}=this;return{left:`${t.x}px`,top:`${t.y}px`,width:e?`${e}px`:"auto",height:n?`${n}px`:"auto",transform:`translate(-50%, -50%) rotate(${o}deg)`}}complete(){const{rotate:t,img:e,pos:{x:n,y:o}}=this,{clientWidth:r,clientHeight:s}=e;return{rotate:t,x:n-r/2,y:o-s/2,width:r,height:s}}mouseDown(t){var e,n,o,r;const{pos:s}=null!==(n=null===(e=null===t||void 0===t?void 0:t.target)||void 0===e?void 0:e.dataset)&&void 0!==n&&n,i=null!==(r=null===(o=null===t||void 0===t?void 0:t.target)||void 0===o?void 0:o.nodeName)&&void 0!==r?r:"";s?(this.drop=!0,this.dropDirection=s):"IMG"===i&&(this.move=!0)}mouseMove(t){const{drop:e,move:n,dropDirection:o}=this,{movementX:r,movementY:s}=t;if(e){let t=0,e=0;"rb"===o?(t=this.width+r,e=this.height+s):"lt"===o?(t=this.width-r,e=this.height-s):"rt"===o?(t=this.width+r,e=this.height-s):"lb"===o&&(t=this.width-r,e=this.height+s),this.width=Math.max(100,t),this.height=Math.max(100,e)}else n&&(this.pos.x+=r,this.pos.y+=s)}mouseup(){this.drop=!1,this.move=!1}init(){return H(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>{const{container:e,box:n}=this;this.pos={x:e.clientWidth/2,y:e.clientHeight/2},this.width=n.clientWidth,this.height=n.clientHeight,t(!0)}),50)}))}))}mounted(){return H(this,void 0,void 0,(function*(){yield this.init()}))}};U([Object(s["c"])({type:String,required:!0})],W.prototype,"url",void 0),U([Object(s["e"])("container")],W.prototype,"container",void 0),U([Object(s["e"])("box")],W.prototype,"box",void 0),U([Object(s["e"])("img")],W.prototype,"img",void 0),U([Object(s["b"])("complete")],W.prototype,"complete",null),W=U([s["a"]],W);var K=W,B=K,Y=n("8ca9");function F(t){this["$style"]=Y["default"].locals||Y["default"]}var X=Object(m["a"])(B,I,L,!1,F,null,null),J=X.exports;S()(X,"components",{QBtn:g["a"],QSlider:y["a"]});var G=function(t,e,n,o){var r,s=arguments.length,i=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i};let V=class extends s["f"]{constructor(){super(...arguments),this.right=!1,this.ctrl=!1,this.isMouseDown=!1,this.resizeableImage=null,this.drawStatus="brush",this.oldPoint={x:0,y:0},this.translatePos={x:0,y:0,z:0},this.brush=new c,this.eraser=new k}get cursor(){const{ctrl:t,isMouseDown:e}=this;return t?"move":e?"crosshair":void 0}brushChange(t){const{ctx:e}=this;e.lineWidth=t.size,e.strokeStyle=t.color,e.fillStyle=t.color,e.globalAlpha=t.transparency/255}eraserChange(t){const{ctx:e}=this;e.lineWidth=t.size}reset(){const{ctx:t,board:e}=this;t.clearRect(0,0,e.width,e.height)}download(){const{board:t}=this,e=document.createElement("a");e.href=t.toDataURL(),e.download="img",e.click()}showImg(t){const{content:e,ctx:n}=this,o=new J({propsData:{url:t}});o.$mount(),e.appendChild(o.$el),o.$on("complete",(t=>{const{x:r,y:s,width:i,height:a,rotate:c}=t;n.save(),n.translate(r+i/2,s+a/2),n.rotate(c*Math.PI/180),n.drawImage(o.img,-i/2,-a/2,i,a),n.restore(),e.removeChild(o.$el),o.$destroy()}))}chooseFile(){const t=document.createElement("input");t.type="file",t.accept="image/*",t.click(),t.addEventListener("change",(()=>{const{files:e}=t;if(e&&e.length>0){const t=URL.createObjectURL(e[0]);this.showImg(t)}}))}keyUp(t){const{key:e}=t;"Control"===e&&(this.ctrl=t.ctrlKey)}keyDown(t){const{key:e}=t;"Control"===e&&(this.ctrl=t.ctrlKey)}boardMouseDown(t){if(t.ctrlKey)return;const{offsetX:e,offsetY:n}=t,{ctx:o,drawStatus:r,brush:s,eraser:i}=this;this.oldPoint={x:e,y:n},this.isMouseDown=!0,"brush"===r?o.lineWidth=s.size:"eraser"===r&&(o.lineWidth=i.size)}boardMouseMove(t){const{offsetX:e,offsetY:n,ctrlKey:o,movementY:r,movementX:s}=t,{drawStatus:i,ctx:a,isMouseDown:c,board:l}=this;e<=1||e>=l.width-1||n<=1||n>=l.height-1||o?this.isMouseDown=!1:c&&("brush"===i?(a.beginPath(),a.moveTo(e-s,n-r),a.lineTo(e,n),a.closePath(),a.stroke()):"eraser"===i&&(a.save(),a.globalCompositeOperation="destination-out",a.beginPath(),a.moveTo(e-s,n-r),a.lineTo(e,n),a.closePath(),a.stroke(),a.restore()))}dropHandler(t){var e;if("drop"===t.type&&t.dataTransfer){const{files:n}=null!==(e=null===t||void 0===t?void 0:t.dataTransfer)&&void 0!==e?e:[];if(n&&n.length>0){const t=URL.createObjectURL(n[0]);this.showImg(t)}}}boardMouseUp(t){if(t.ctrlKey)return;const{drawStatus:e,isMouseDown:n}=this;n&&("brush"!==e&&"eraser"!==e||(this.isMouseDown=!1))}contentMouseDown(){const{content:t,ctrl:e}=this;e&&t.addEventListener("mousemove",this.contentMouseMove)}contentMouseMove(t){const{translatePos:e}=this,{movementY:n,movementX:o}=t;e.x+=o,e.y+=n}contentWheel(t){const{translatePos:e}=this,{deltaY:n,ctrlKey:o}=t;o&&t.preventDefault(),n<0?e.z+=10:e.z-=10}contentMouseUp(){const{content:t}=this;t.removeEventListener("mousemove",this.contentMouseMove)}mounted(){var t;const{board:e}=this;if(window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),null!==(t=e.getContext)&&void 0!==t&&t){const t=this.ctx=this.board.getContext("2d");setTimeout((()=>{t.lineCap="round",t.lineJoin="round"}))}e.width=document.body.clientWidth,e.height=document.body.clientHeight-58}beforeDestroy(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp)}};G([Object(s["e"])("board")],V.prototype,"board",void 0),G([Object(s["e"])("content")],V.prototype,"content",void 0),G([Object(s["g"])("brush",{deep:!0})],V.prototype,"brushChange",null),G([Object(s["g"])("eraser",{deep:!0})],V.prototype,"eraserChange",null),V=G([Object(s["a"])({components:{ResizeableImage:J,EraserComponent:E,BrushComponent:M}})],V);var Z=V,A=Z,N=n("5b88"),tt=n("9989"),et=n("4e73"),nt=n("05c0"),ot=n("9404");function rt(t){this["$style"]=N["default"].locals||N["default"]}var st=Object(m["a"])(A,o,r,!1,rt,null,null);e["default"]=st.exports;S()(st,"components",{QPage:tt["a"],QBtn:g["a"],QMenu:et["a"],QTooltip:nt["a"],QDrawer:ot["a"]})},"8ca9":function(t,e,n){"use strict";var o=n("2e08"),r=n.n(o);n.d(e,"default",(function(){return r.a}))},"8eca":function(t,e,n){t.exports={eraserContainer:"eraser_eraserContainer_2Fq9c"}},a71d:function(t,e,n){"use strict";var o=n("8eca"),r=n.n(o);n.d(e,"default",(function(){return r.a}))},f403:function(t,e,n){"use strict";var o=n("22dd"),r=n.n(o);n.d(e,"default",(function(){return r.a}))}}]);